!function(t){function e(i){if(o[i])return o[i].exports;var n=o[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,e),n.l=!0,n.exports}var o={};e.m=t,e.c=o,e.d=function(t,o,i){e.o(t,o)||Object.defineProperty(t,o,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var o=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(o,"a",o),o},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=4)}([function(t,e,o){"use strict";function i(){}i.yesOrNo=function(t){return t=t||.5,Math.random()<t},i.getRandomIntExclusive=function(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t))+t},i.getRandomIntInclusive=function(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t},i.shuffle=function(t){for(var e,o,i=t.length;0!==i;)o=Math.floor(Math.random()*i),i-=1,e=t[i],t[i]=t[o],t[o]=e;return t},e.a=i},function(t,e,o){"use strict";function i(t,e){this.rowCount=t,this.colCount=e,this.cells={},this.cellArray=[],this._init()}i.prototype._init=function(){this.cells={},this.cellArray=[];for(var t=0;t<this.rowCount;t++){this.cells[t]={};for(var e=0;e<this.colCount;e++){var o={row:t,col:e,population:0,isEmpty:!1,board:this};this.cells[t][e]=o,this.cellArray.push(o)}}},i.prototype.getCell=function(t){return this.cells[t.row][t.col]},i.prototype.clearCell=function(t){this.cells[t.row][t.col].isEmpty=!0},i.prototype.unclearCell=function(t){this.cells[t.row][t.col].isEmpty=!1},i.prototype.getNonEmptyCells=function(){return this.cellArray.filter(function(t){return!t.isEmpty})},i.prototype.getOcuppiedCells=function(){return this.cellArray.filter(function(t){return!t.isEmpty&&void 0!==t.player})},i.prototype.getPlayerCells=function(t){return this.cellArray.filter(function(e){return!e.isEmpty&&e.player===t})},i.prototype.getAllCells=function(){return this.cellArray},i.prototype.getFirstNonEmptyCell=function(){return this.cellArray.find(function(t){return!t.isEmpty})},i.prototype.getAdjacentCells=function(t){var e=i.getAdjacentCoordinates(t);return e=e.filter(function(t){return t.row>=0&&t.col>=0&&t.row<this.rowCount&&t.col<this.colCount&&!this.cells[t.row][t.col].isEmpty}.bind(this)),e.map(function(t){return this.cells[t.row][t.col]}.bind(this))},i.getAdjacentCoordinates=function(t){var e=t.row,o=t.col;return e%2==0?[{row:e-1,col:o-1},{row:e-1,col:o},{row:e,col:o+1},{row:e+1,col:o},{row:e+1,col:o-1},{row:e,col:o-1}]:[{row:e-1,col:o},{row:e-1,col:o+1},{row:e,col:o+1},{row:e+1,col:o+1},{row:e+1,col:o},{row:e,col:o-1}]},i.isSameCoordinates=function(t,e){var o=t?t.row:void 0,i=e?e.row:void 0,n=t?t.col:void 0,r=e?e.col:void 0;return o===i&&n===r},i.isAdjacent=function(t,e){return i.getAdjacentCoordinates(t).findIndex(function(t){return t.row===e.row&&t.col===e.col})>=0},e.a=i},function(t,e,o){"use strict";function i(t,e){this.board=t,this.game=e,this.highlightedCell=void 0,this.selectedCell=void 0,this.canvas=document.getElementById("game"),this.ctx=this.canvas.getContext("2d"),this.canvas.onmousemove=this.onMouseMove.bind(this),document.getElementById("advance").onclick=function(t){t.stopPropagation(),t.preventDefault(),this.game.onAdvanceTurn.call(this.game)}.bind(this),document.onclick=this.onClick.bind(this),document.ondblclick=this.onDoubleClick.bind(this),document.onkeydown=function(t){if(32===t.keyCode)return this.game.onAdvanceTurn.call(this.game),t.preventDefault()}.bind(this),this.buildCellPaths()}var n=o(5),r=o(1);i.PLAYER_COLORS=["red","gold","green","chocolate","cyan"],i.CELL_STYLES={unoccupied:{bg:"lightgray",border:"white"},occupied:{border:"white"},selected:{border:"blue"}},i.prototype.buildCellPaths=function(){var t=n.a.getHexDimensions(),e={x:Math.ceil(t.width/2),y:Math.ceil(t.height/2)};this.board.getNonEmptyCells().forEach(function(t){var o=n.a.getHexCenterPosition(t.row,t.col,n.a.HEX_EDGE_SIZE,e),i=n.a.buidHexPath(o,n.a.HEX_EDGE_SIZE);t.hex={path:i,center:o}})},i.prototype.draw=function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.board.getNonEmptyCells().forEach(function(t){t.hex;if(this.setHexBackgroundStyle(t),this.ctx.fill(t.hex.path),r.a.isSameCoordinates(t,this.selectedCell)&&this.ctx.stroke(t.hex.path),t.population>0){this.setHexTextStyle();var e=t.population;this.ctx.fillText(e,t.hex.center.x,t.hex.center.y)}}.bind(this))},i.prototype.setHexBackgroundStyle=function(t){this.ctx.lineWidth=2,this.ctx.globalAlpha=1,r.a.isSameCoordinates(t,this.selectedCell)?(this.ctx.fillStyle=i.PLAYER_COLORS[t.player],this.ctx.strokeStyle=i.CELL_STYLES.selected.border):void 0!=t.player?(this.ctx.fillStyle=i.PLAYER_COLORS[t.player],this.ctx.strokeStyle=i.CELL_STYLES.occupied.border):(this.ctx.fillStyle=i.CELL_STYLES.unoccupied.bg,this.ctx.strokeStyle=i.CELL_STYLES.unoccupied.border),r.a.isSameCoordinates(t,this.highlightedCell)&&(this.ctx.globalAlpha=.75)},i.prototype.setHexTextStyle=function(){this.ctx.font="13px monospace",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillStyle="black"},i.prototype.onMouseMove=function(t){var e={x:t.clientX-t.target.offsetLeft,y:t.clientY-t.target.offsetTop},o=this.getCellOnPoint(e);this._highlightCell(o)},i.prototype.onClick=function(t){var e={x:t.clientX-t.target.offsetLeft,y:t.clientY-t.target.offsetTop},o=this.getCellOnPoint(e);if(!o)return this.game.onPlayerClickEmptySpace();t.shiftKey?this.game.onPlayerShiftClick(o):this.game.onPlayerClick(o)},i.prototype.onDoubleClick=function(t){var e={x:t.clientX-t.target.offsetLeft,y:t.clientY-t.target.offsetTop},o=this.getCellOnPoint(e);this.game.onPlayerDoubleClick(o)},i.prototype.selectCell=function(t){this.selectedCell=t},i.prototype.unselectCell=function(){this.selectedCell=void 0},i.prototype._highlightCell=function(t){r.a.isSameCoordinates(t,this.highlightedCell)||(this.highlightedCell=t,this.draw())},i.prototype.getCellOnPoint=function(t){return this.board.getNonEmptyCells().find(function(e){return this.ctx.isPointInPath(e.hex.path,t.x,t.y)}.bind(this))},i.calculateCanvasSize=function(){var t=Math.min(document.documentElement.clientWidth,window.innerWidth||0)-30,e=Math.min(document.documentElement.clientHeight,window.innerHeight||0)-50,o={width:t,height:e},i=n.a.calculateGridSize(o),r=n.a.getHexDimensions();return{height:e,width:(i.colCount+1)*r.width,rowCount:i.rowCount,colCount:i.colCount}},e.a=i},function(t,e,o){"use strict";function i(){}var n=o(0);i.updatePopulationAfterAttack=function(t,e,o){var i=t.population-1-o.attackerKills;o.attackWin?(t.population=1,e.population=i,e.player=t.player):(t.population=i+1,e.population-=o.defenderKills)},i.simulateRiskAttack=function(t,e){for(var o=Math.min(t,e),i=0,r=0;o-- >0;)n.a.yesOrNo()?r++:i++;return{attackerKills:i,defenderKills:r,attackWin:r===e}},e.a=i},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(2),n=o(6),r=i.a.calculateCanvasSize(),l=document.getElementById("game");l.height=r.height,l.width=r.width,document.querySelector(".container").setAttribute("style","width: "+r.width+"px;"),new n.a(r.rowCount,r.colCount,5).init()},function(t,e,o){"use strict";function i(){}i.HEX_EDGE_SIZE=30,i.buidHexPath=function(t,e){var o,n,r={x:null,y:null};e=e||i.HEX_EDGE_SIZE,e-=1.5;for(var l=new Path2D,a=0;a<=6;a++)o=60*a+30,n=Math.PI/180*o,r.x=t.x+e*Math.cos(n),r.y=t.y+e*Math.sin(n),0===a?l.moveTo(r.x,r.y):l.lineTo(r.x,r.y);return l},i.getHexCenterPosition=function(t,e,o,i){i=i,o=o||50;var n=2*o,r=Math.sqrt(3)/2*n,l=e*r,a=t*(3*n/4);return t%2!=0&&(l+=r/2),{x:i.x+l,y:i.y+a}},i.getHexDimensions=function(){var t=2*i.HEX_EDGE_SIZE;return{height:t,width:Math.sqrt(3)/2*t}},i.calculateGridSize=function(t){var e=i.getHexDimensions(),o=e.height,n=Math.ceil(3*e.height/4),r=Math.floor((t.height-o)/n)+1,l=Math.floor(t.width/e.width);return l=Math.min(l,r),{rowCount:r,colCount:l}},e.a=i},function(t,e,o){"use strict";function i(t,e,o){this.rowCount=t,this.colCount=e,this.playerCount=o,this.npcs=[],this.player=void 0,this.originCell=void 0}var n=o(7),r=o(8),l=o(9),a=o(2),s=o(0),c=o(1);i.PLAYER_ID=0,i.MAX_POPULATION=10,i.prototype.init=function(){var t=new n.a(this.rowCount,this.colCount,this.playerCount);this.board=t.generateBoard(),this.player=new r.a(i.PLAYER_ID),this.npcs=[];for(var e=1;e<this.playerCount;e++)this.npcs.push(new l.a(e,this.board));this.grid=new a.a(this.board,this),this.grid.draw()},i.prototype.grow=function(){this.board.getOcuppiedCells().forEach(function(t){var e=Math.min(t.population,3),o=s.a.getRandomIntInclusive(0,e),n=Math.min(t.population+o,i.MAX_POPULATION);t.population=n})},i.prototype.onAdvanceTurn=function(){this.unselectOrigin(),this.npcs.forEach(function(t){t.playTurn.call(t)}),this.grow(),this.grid.draw()},i.prototype.onPlayerDoubleClick=function(t){this.resolvePlayerAction(t,r.a.MOVE_TYPE_GROUP)},i.prototype.onPlayerShiftClick=function(t){this.unselectOrigin(),this.player.moveAllAdjacentToCell(t),this.grid.draw()},i.prototype.onPlayerClickEmptySpace=function(t){this.unselectOrigin(),this.grid.draw()},i.prototype.onPlayerClick=function(t){this.resolvePlayerAction(t,r.a.MOVE_TYPE_SINGLE)},i.prototype.resolvePlayerAction=function(t,e){e=e||r.a.MOVE_TYPE_SINGLE;var o=void 0===t,n=void 0!==this.originCell,l=t&&t.player===i.PLAYER_ID,a=t&&void 0===t.player,s=!l&&!a;if(o)this.unselectOrigin();else if(n){var u=c.a.isSameCoordinates(this.originCell,t),h=c.a.isAdjacent(this.originCell,t);u?this.unselectOrigin():h?s?this.player.attack(this.originCell,t):this.player.moveToCell(this.originCell,t,e):l?(this.originCell=t,this.grid.selectCell(this.originCell)):this.unselectOrigin()}else l&&(this.originCell=t,this.grid.selectCell(this.originCell));this.originCell&&1===this.originCell.population&&this.unselectOrigin(),this.grid.draw()},i.prototype.unselectOrigin=function(t){this.originCell=void 0,this.grid.unselectCell()},e.a=i},function(t,e,o){"use strict";function i(t,e,o){this.playerCount=o,this.rowCount=t,this.colCount=e;var i=Math.max(t,e);this.maxEmpty=Math.round(i*i/2),this.minEmpty=Math.round(.7*this.maxEmpty)}var n=o(1),r=o(0);i.prototype.generateBoard=function(){return this.emptyCount=0,this.board=new n.a(this.rowCount,this.colCount),this.removeSomeCells(),this.getRandomCells(this.playerCount).forEach(function(t,e){t.player=e,t.population=3}),this.board},i.prototype.removeSomeCells=function(){for(;this.emptyCount<this.minEmpty;){var t=this.getRandomCells()[0];if(!t)break;if(this.removeCell(t),!this.isBoardConnected(this.board)){this.undoRemoveCell(t);break}for(;this.emptyCount<this.maxEmpty&&r.a.yesOrNo(.7)&&(t=this.getRandomAdjacentCell(t));)if(this.removeCell(t),!this.isBoardConnected(this.board)){this.undoRemoveCell(t);break}}},i.prototype.getRandomCells=function(t){t=t||1;for(var e=[],o=this.board.getNonEmptyCells();e.length<t&&o.length>0;){var i=r.a.getRandomIntExclusive(0,o.length);e.push(o[i]),o.splice(i,1)}return e},i.prototype.removeCell=function(t){this.board.clearCell(t),this.emptyCount++},i.prototype.undoRemoveCell=function(t){this.board.unclearCell(t),this.emptyCount--},i.prototype.getRandomAdjacentCell=function(t){var e=this.board.getAdjacentCells(t);if(0!==e.length){return e[r.a.getRandomIntExclusive(0,e.length)]}},i.prototype.isBoardConnected=function(){var t=this.board.getFirstNonEmptyCell();return this.board.getAllCells().forEach(function(t){t.isConnected=!1}),this.connectCellAndAdjcent(t),this.board.getNonEmptyCells().findIndex(function(t){return!t.isConnected})<0},i.prototype.connectCellAndAdjcent=function(t){if(!t.isConnected){t.isConnected=!0;this.board.getAdjacentCells(t).filter(function(t){return!t.isConnected&&!t.isEmpty}).forEach(function(t){this.connectCellAndAdjcent(t)}.bind(this))}},e.a=i},function(t,e,o){"use strict";function i(t){this.id=t}var n=o(3);i.POPULATION_GROUP_SIZE=3,i.MOVE_TYPE_ALL="all",i.MOVE_TYPE_GROUP="group",i.MOVE_TYPE_SINGLE="single",i.prototype.moveAllAdjacentToCell=function(t){if(t.player==this.id||void 0===t.player){this._getAdjcentPlayerCellsWithPopulation(t).forEach(function(e){this.moveToCell(e,t,i.MOVE_TYPE_ALL)}.bind(this))}},i.prototype.moveToCell=function(t,e,o){if(t.player==this.id){var n=t.population-1;if(!(n<1)){var r=1;"all"===o?r=n:"group"===o&&Math.min(n,i.POPULATION_GROUP_SIZE),r>0&&(t.population-=r,e.player=this.id,e.population+=r)}}},i.prototype.moveToEmptyCell=function(t){if(!(t.population>0)){var e=this._getAdjcentPlayerCellsWithPopulation(t),o=0;e.forEach(function(t){var e=Math.ceil(t.population/2);o+=e,t.population-=e}),o>0&&(t.player=this.id,t.population=o)}},i.prototype.attack=function(t,e){var o=t.population-1,i=e.population,r=n.a.simulateRiskAttack(o,i);n.a.updatePopulationAfterAttack(t,e,r)},i.prototype.attackFromAllAdjacent=function(t){for(var e=this._getAdjcentPlayerCellsWithPopulation(t),o=0;o<e.length;o++){var i=e[o],r=i.population-1,l=t.population,a=n.a.simulateRiskAttack(r,l);if(n.a.updatePopulationAfterAttack(i,t,a),a.attackWin)break}},i.prototype._getAdjcentPlayerCellsWithPopulation=function(t){var e=this.id;return t.board.getAdjacentCells(t).filter(function(t){return t.player===e&&t.population>1})},e.a=i},function(t,e,o){"use strict";function i(t,e){this.id=t,this.board=e,this.actionResolvers=[r.a.spreadMove,r.a.stay,r.a.kamikazeAttack,r.a.attackIfStronger]}var n=o(0),r=o(10);i.prototype.playTurn=function(){this.board.getPlayerCells(this.id).forEach(function(t){t.noAction=!1});for(var t=this.actionResolvers,e=this.getPossibleActions();e.length;)t=n.a.shuffle(t),t.forEach(function(t){t(e),e=this.getPossibleActions()}.bind(this))},i.prototype.getPossibleActions=function(){var t=this.board.getPlayerCells(this.id).filter(function(t){return t.population>1&&!0!==t.noAction}),e=t.map(this.getPossibleActionsOnCell.bind(this));return[].concat.apply([],e)},i.prototype.getPossibleActionsOnCell=function(t){var e=this.id,o=this.board.getAdjacentCells(t),i=o.filter(function(t){return 0===t.population}),n=o.filter(function(t){return t.population>0&&t.player!==e}),r=[{type:"stay",origin:t}];return r.push({type:"move",origin:t,targetCount:i.length,targets:i}),n.forEach(function(e){r.push({type:"attack",origin:t,target:e,attackingPopulation:t.population,defendingPopulation:e.population,positiveChances:50+t.population-e.population,chances:t.population-e.population})}),r},e.a=i},function(t,e,o){"use strict";function i(){}var n=o(3);i.spreadMove=function(t){var e=t.filter(function(t){return"move"===t.type}).sort(function(t,e){return e.targetCount-t.targetCount});if(e.length)for(var o=e[0].origin,i=e[0].targets,n=o.player;o.population>1&&i.length>0;){var r=i.pop(),l=1,a=o.population-1;i.length||(l=o.population-1,a=1),r.player=n,r.population=l,o.population=a}},i.stay=function(t){var e=t.find(function(t){return"stay"===t.type});e&&(e.origin.noAction=!0)},i.kamikazeAttack=function(t){var e=t.filter(function(t){return"attack"===t.type}).sort(function(t,e){return e.positiveChances-t.positiveChances});if(e.length){var o=e[0].origin,i=e[0].target,r=(o.player,n.a.simulateRiskAttack(o.population,i.population));n.a.updatePopulationAfterAttack(o,i,r)}},i.attackIfStronger=function(t){var e=t.filter(function(t){return"attack"===t.type&&t.chances>0}).sort(function(t,e){return e.positiveChances-t.positiveChances});if(e.length){var o=e[0].origin,i=e[0].target,r=(o.player,n.a.simulateRiskAttack(o.population,i.population));n.a.updatePopulationAfterAttack(o,i,r)}},e.a=i}]);